# 文档对话功能说明

## 功能概述

文档对话功能允许您上传PDF简历，然后通过自然语言与AI助手对话，询问关于简历的任何问题。这是一个更加灵活和交互式的简历分析方式。

## 核心特点

### 🚀 简单直接
- **无需本地解析**：PDF文件直接发送给大模型处理
- **即传即用**：上传后立即可以开始对话
- **轻量级实现**：遵循KISS原则，代码简洁易维护

### 💬 智能对话
- **上下文理解**：AI记住整个对话历史
- **自然语言交互**：用自然语言提问，无需特定格式
- **深度分析**：可以深入询问简历的任何细节

### 🎯 实用功能
- **快捷问题**：预设常用问题，一键提问
- **对话历史**：保持完整的对话上下文
- **随时清除**：可以清除对话重新开始

## 使用方法

### 1. 访问文档对话页面
```
http://localhost:5001/chat
```

或在首页点击右上角的"💬 文档对话"按钮

### 2. 上传PDF简历
- 点击上传区域或拖拽PDF文件
- 只支持PDF格式
- 点击"上传并分析"按钮
- 等待AI分析完成

### 3. 与AI对话
上传成功后，您可以：

#### 使用快捷问题
系统提供了5个常用问题：
- 💡 总结核心优势
- 💼 查看工作经验
- 🔧 查看技能列表
- 🎓 查看教育背景
- 🎯 适合的职位

#### 自由提问
在输入框中输入任何问题，例如：
- "这位候选人有多少年工作经验？"
- "他在哪些公司工作过？"
- "他的技术栈是什么？"
- "他的优势和劣势分别是什么？"
- "这份简历适合我们的Python后端工程师职位吗？"
- "候选人参与过哪些项目？"
- "如何评价这位候选人？"

### 4. 查看AI回复
- AI会基于简历内容给出详细回答
- 支持多轮对话，AI会记住之前的内容
- 可以追问更多细节

### 5. 管理对话
- **清除对话**：点击"清除对话"按钮重新开始
- **切换文档**：上传新文档会开启新的对话会话

## API接口说明

### 1. 上传文档
```
POST /api/upload_document
Content-Type: multipart/form-data

参数：
- file: PDF文件

返回：
{
    "success": true,
    "doc_id": "文档ID",
    "analysis": "AI初步分析结果",
    "message": "文档分析完成"
}
```

### 2. 对话
```
POST /api/chat_with_document
Content-Type: application/json

参数：
{
    "doc_id": "文档ID",
    "message": "用户问题"
}

返回：
{
    "success": true,
    "doc_id": "文档ID",
    "user_message": "用户问题",
    "ai_response": "AI回复",
    "conversation_length": 对话轮数
}
```

### 3. 清除对话
```
POST /api/clear_conversation
Content-Type: application/json

参数：
{
    "doc_id": "文档ID"
}

返回：
{
    "success": true,
    "message": "对话已清除"
}
```

### 4. 获取对话历史
```
GET /api/conversation_history/<doc_id>

返回：
{
    "doc_id": "文档ID",
    "history": [
        {
            "role": "user",
            "content": "用户消息"
        },
        {
            "role": "assistant",
            "content": "AI回复"
        }
    ],
    "count": 对话条数
}
```

## 技术实现

### 架构设计
```
用户上传PDF → 后端保存文件 → PyPDF2提取文本 → 发送给大模型 → AI分析 → 保存到对话历史
用户提问 → 添加到对话历史 → 发送给大模型 → AI回复 → 更新对话历史 → 返回给用户
```

### 核心模块

#### document_chat.py
- `DocumentChatAgent`：文档对话代理类
- `analyze_document()`：分析PDF文档
- `chat_with_document()`：处理对话
- `get_conversation_history()`：获取历史
- `clear_conversation()`：清除历史

#### app.py 新增路由
- `/chat`：文档对话页面
- `/api/upload_document`：上传API
- `/api/chat_with_document`：对话API
- `/api/clear_conversation`：清除API
- `/api/conversation_history/<doc_id>`：历史API

### 对话历史管理
- 使用内存存储对话历史（`conversation_history`字典）
- 每个文档有独立的对话会话
- 包含系统消息、用户消息、AI回复

### AI模型配置
使用.env文件中配置的模型：
```
OPENAI_API_KEY=your_api_key
OPENAI_BASE_URL=https://openrouter.ai/api/v1
OPENAI_MODEL=deepseek/deepseek-chat-v3.1:free
```

## 优势对比

### 文档对话 vs 传统筛选

| 特性 | 文档对话 | 传统筛选 |
|-----|---------|---------|
| 交互方式 | 自然语言对话 | 固定规则匹配 |
| 灵活性 | 极高，可任意提问 | 受限于预设维度 |
| 分析深度 | AI深度理解 | 关键词匹配 |
| 使用场景 | 详细了解候选人 | 批量快速筛选 |
| 学习曲线 | 几乎没有 | 需要了解筛选规则 |

### 适用场景

**文档对话适合：**
- 需要深入了解候选人
- 针对性地询问特定信息
- 评估候选人是否适合特定项目
- 准备面试问题
- 详细分析简历细节

**传统筛选适合：**
- 批量处理大量简历
- 快速初步筛选
- 按固定维度排序
- 统计分析
- 生成筛选报告

## 扩展建议

1. **多文档对比**：支持同时对比多份简历
2. **对话导出**：导出对话记录为PDF报告
3. **语音输入**：支持语音提问
4. **智能推荐**：AI主动推荐关注点
5. **持久化存储**：将对话历史保存到数据库
6. **协作功能**：多人共同分析一份简历
7. **模板问题库**：针对不同岗位的问题模板

## 注意事项

1. **对话历史存储**：当前存储在内存中，服务器重启后会丢失
2. **文件大小限制**：PDF文件最大16MB
3. **对话长度**：长时间对话可能消耗较多token
4. **API调用**：每次对话都会调用大模型API
5. **并发处理**：多用户同时使用时需要注意会话隔离

## 示例对话

```
用户：这份简历的候选人有几年工作经验？
AI：根据简历内容，这位候选人有5年的工作经验，从2018年开始工作至今。

用户：他在哪些公司工作过？
AI：候选人的工作经历包括：
1. 2018-2020：XX科技有限公司，担任初级工程师
2. 2020-2022：YY互联网公司，担任高级工程师
3. 2022-至今：ZZ集团，担任技术专家

用户：他的技术栈主要是什么？
AI：候选人的主要技术栈包括：
- 后端：Python、Java、Go
- 框架：Django、Flask、Spring Boot
- 数据库：MySQL、PostgreSQL、Redis
- 工具：Docker、Kubernetes、Git

用户：这位候选人适合我们的Python后端架构师职位吗？
AI：从简历来看，这位候选人非常适合Python后端架构师职位，理由如下：
1. 拥有5年Python开发经验，技术深度足够
2. 熟悉Django和Flask框架，有实际项目经验
3. 掌握微服务架构和容器化技术
4. 有团队管理和技术选型经验
建议安排面试进一步了解其架构设计能力。
```

## 总结

文档对话功能提供了一种全新的、更加灵活的简历分析方式。通过自然语言对话，您可以像与HR同事交流一样，快速获取关于候选人的任何信息。这大大提升了简历分析的效率和深度。
