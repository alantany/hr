# Tab化界面功能说明

## 系统架构升级

系统现在采用Tab化设计，在一个页面中集成两种工作模式，方便切换使用。

## 访问地址

**新版主页（Tab界面）：** http://localhost:5001  
**文档对话（独立页面）：** http://localhost:5001/chat  
**旧版页面：** http://localhost:5001/old

## 两个Tab功能

### Tab 1: 文档对话 💬

**功能特点：**
- 单份简历深度分析
- AI智能问答
- 多轮对话支持
- 适合详细了解候选人

**使用场景：**
- 需要深入了解某个候选人
- 准备面试问题
- 针对性询问特定信息
- 评估候选人综合素质

**操作方式：**
- 点击Tab切换到"文档对话"
- 点击链接进入完整对话页面
- 上传PDF简历
- 开始对话

### Tab 2: 智能筛选 🔍

**功能特点：**
- **批量上传，静默处理**：上传时不返回分析内容，快速添加到简历池
- **自然语言查询**：用自然语言提问，AI智能筛选
- **智能匹配**：AI理解需求，返回符合条件的候选人
- **详细说明**：每个候选人都有匹配原因和亮点

**核心优势：**
1. ✅ 上传快速：无需等待每份简历的分析结果
2. ✅ 灵活查询：随时根据不同需求筛选
3. ✅ 智能理解：AI理解复杂的筛选条件
4. ✅ 结果清晰：直观显示匹配原因

## 使用流程

### 智能筛选的完整流程

#### 第一步：批量上传简历
```
1. 切换到"智能筛选"Tab
2. 拖拽或选择多个PDF文件
3. 点击"上传到简历池"
4. 系统静默处理，快速完成
```

**特点：**
- 不会显示每份简历的分析内容
- 只返回"简历已添加到筛选池"的确认
- 可以连续上传多批次

#### 第二步：查看简历池
```
上传完成后，左侧会显示：
- 简历池统计（总数）
- 简历列表（文件名和候选人姓名）
- 可以单独移除某份简历
- 可以清空整个简历池
```

#### 第三步：自然语言查询
```
在查询框中输入需求，例如：
- "帮我找到本科以上学历的候选人"
- "找出有3年以上Python开发经验的人"
- "筛选出会React和Vue的前端工程师"
- "找到有管理经验且英语流利的候选人"
```

**快捷查询：**
系统提供4个常用查询按钮：
- 🎓 本科以上学历
- 💼 3年以上经验
- 🐍 会Python
- 👔 有管理经验

#### 第四步：查看筛选结果
```
AI会返回：
1. 统计信息（总数、符合数、匹配率）
2. 筛选总结（一句话概括）
3. 符合条件的候选人列表，包括：
   - 候选人姓名
   - 符合原因
   - 候选人亮点
   - 基本信息（文件名、经验、技能）
```

## 查询示例

### 示例1：按学历筛选
**查询：** "帮我找到本科以上学历的候选人"

**AI返回：**
```
✅ 找到3位本科以上学历的候选人

👤 张三
📝 符合原因：北京大学计算机专业本科毕业，学历符合要求
✨ 亮点：985院校 | 计算机专业 | GPA 3.8

👤 李四
📝 符合原因：清华大学硕士学历，超出要求
✨ 亮点：顶尖院校 | 硕士学历 | 研究经历丰富
```

### 示例2：按技能和经验组合筛选
**查询：** "找出有3年以上Python开发经验，并且会Django的候选人"

**AI返回：**
```
✅ 找到2位符合条件的候选人

👤 王五
📝 符合原因：5年Python开发经验，熟练使用Django框架，有多个项目实战
✨ 亮点：经验丰富 | Django专家 | 电商项目经验

👤 赵六
📝 符合原因：4年Python开发，主要使用Django，参与过大型Web应用开发
✨ 亮点：大厂背景 | 高并发经验 | 架构能力
```

### 示例3：复杂条件查询
**查询：** "找到有管理经验、英语流利、并且技术能力强的候选人"

**AI返回：**
```
✅ 找到1位高度匹配的候选人

👤 孙七
📝 符合原因：曾担任技术经理，管理15人团队；英语六级，经常参与国际会议；精通多种技术栈
✨ 亮点：管理经验2年 | 英语能力强 | 技术全面 | 沟通能力出色
```

## API接口说明

### 1. 添加简历到池
```
POST /api/batch_add_resume
Content-Type: multipart/form-data

参数：
- file: PDF文件

返回：
{
    "success": true,
    "doc_id": "文档ID",
    "filename": "文件名",
    "message": "简历已添加到筛选池"
}
```

### 2. 智能查询
```
POST /api/batch_query
Content-Type: application/json

参数：
{
    "query": "帮我找到本科以上学历的候选人"
}

返回：
{
    "success": true,
    "query": "原始查询",
    "total_resumes": 10,
    "match_count": 3,
    "matched_resumes": [
        {
            "doc_id": "文档ID",
            "filename": "文件名",
            "name": "候选人姓名",
            "reason": "符合原因",
            "highlights": ["亮点1", "亮点2"],
            "basic_info": {
                "name": "姓名",
                "experience_years": 5,
                "skills": ["技能列表"]
            }
        }
    ],
    "summary": "筛选总结",
    "message": "找到3份符合条件的简历"
}
```

### 3. 获取简历池状态
```
GET /api/batch_pool_status

返回：
{
    "total_count": 10,
    "resumes": [
        {
            "doc_id": "文档ID",
            "filename": "文件名",
            "name": "候选人姓名"
        }
    ]
}
```

### 4. 清空简历池
```
POST /api/batch_clear_pool

返回：
{
    "success": true,
    "message": "已清空10份简历"
}
```

### 5. 移除单个简历
```
POST /api/batch_remove_resume
Content-Type: application/json

参数：
{
    "doc_id": "文档ID"
}

返回：
{
    "success": true,
    "message": "已移除简历: 文件名"
}
```

## 技术实现

### 核心模块

#### batch_screener.py
```python
class BatchResumeScreener:
    - add_resume_to_pool()   # 添加简历（静默）
    - query_resumes()         # 智能查询
    - get_pool_status()       # 获取状态
    - clear_pool()            # 清空池
    - remove_resume()         # 移除简历
```

**特点：**
- 使用内存存储简历池（重启会丢失）
- 上传时只提取基本信息，不做深度分析
- 查询时才调用AI进行智能匹配

### 工作原理

#### 上传阶段
```
PDF文件 → PyPDF2提取文本 → 基础分析器提取关键信息 
→ 存储到简历池 → 返回确认信息（不返回分析内容）
```

#### 查询阶段
```
用户查询 → 准备简历摘要 → 发送给AI分析 
→ AI理解需求并匹配 → 返回符合条件的候选人 → 显示结果
```

**AI提示词结构：**
```python
prompt = f"""
你是一个专业的HR助手。我有{N}份简历，需要根据以下要求进行筛选：

查询要求：{用户查询}

简历摘要信息：
[简历1, 简历2, ...]

请分析这些简历，返回符合要求的候选人，包括：
- 候选人信息
- 符合原因
- 候选人亮点
"""
```

## 对比两种模式

| 特性 | 文档对话 | 智能筛选 |
|-----|---------|---------|
| **处理方式** | 单份深度分析 | 批量静默处理 |
| **上传反馈** | 立即显示分析 | 只确认添加 |
| **交互方式** | 多轮对话 | 单次查询 |
| **结果形式** | 对话内容 | 匹配列表 |
| **适用场景** | 详细了解 | 快速筛选 |
| **AI调用** | 每次对话 | 仅查询时 |
| **存储方式** | 对话历史 | 简历池 |

## 推荐工作流程

### 场景一：初步筛选大量简历
```
1. 使用"智能筛选"Tab
2. 批量上传所有简历（快速，无需等待）
3. 根据基本条件查询（如：本科、3年经验）
4. 快速找到符合基础条件的候选人
```

### 场景二：深入了解重点候选人
```
1. 从"智能筛选"获得重点候选人列表
2. 切换到"文档对话"Tab或独立页面
3. 上传重点候选人的简历
4. 深入对话，了解细节
5. 准备针对性的面试问题
```

### 场景三：多维度筛选
```
1. 第一轮：学历筛选（如：本科以上）
2. 第二轮：技能筛选（如：会Python和Django）
3. 第三轮：经验筛选（如：3年以上且有项目经验）
4. 第四轮：软技能筛选（如：有管理经验或英语好）
```

## 优势总结

### 智能筛选的核心优势

1. **快速高效**
   - 批量上传无需等待分析
   - 一次上传，多次查询
   - 快速切换筛选条件

2. **灵活智能**
   - 自然语言表达需求
   - AI理解复杂条件
   - 组合查询能力强

3. **结果清晰**
   - 直观的匹配原因
   - 候选人亮点展示
   - 统计数据一目了然

4. **成本优化**
   - 上传时不调用AI
   - 只在查询时使用AI
   - 降低API调用成本

## 注意事项

1. **简历池存储**：当前在内存中，服务器重启会丢失
2. **PDF格式**：智能筛选只支持PDF格式
3. **查询语言**：建议使用中文，更准确
4. **AI理解**：复杂查询可能需要多次尝试优化表达

## 未来扩展

1. **持久化存储**：将简历池保存到数据库
2. **多格式支持**：支持Word、TXT等格式
3. **高级筛选**：支持更复杂的逻辑组合
4. **结果导出**：导出筛选结果为Excel或PDF
5. **历史记录**：保存查询历史，快速重复查询
