# 🔥 热重载功能说明

## ✅ 已启用自动重载

系统现在已经配置了 Flask 的自动重载功能，修改代码后会自动生效！

## 🎯 工作原理

Flask 的 debug 模式包含了 **Werkzeug 的重载器 (reloader)**，它会：

1. **监控文件变化**: 自动监控 Python 文件的修改
2. **自动重启**: 检测到文件变化后自动重启服务器
3. **保持端口**: 重启时保持在同一端口运行

## 📝 支持的修改类型

以下修改会自动触发重载：

### ✅ 会自动重载的文件
- ✅ `app.py` - 主应用文件
- ✅ `ai_resume_analyzer.py` - AI分析器
- ✅ `batch_screener.py` - 批量筛选器
- ✅ `benefit_screener.py` - 福利政策筛选器
- ✅ `resume_analyzer.py` - 简历分析器
- ✅ `resume_screener.py` - 简历筛选器
- ✅ `document_chat.py` - 文档对话
- ✅ 其他所有 `.py` 文件

### ⚠️ 不会自动重载的文件
- ❌ `.env` 文件 - 环境变量需要重启
- ❌ `templates/*.html` - HTML 模板（但浏览器刷新即可）
- ❌ 静态文件 - 浏览器刷新即可

## 🔍 如何验证热重载

### 测试步骤：

1. **修改代码**
   ```python
   # 例如在 app.py 中添加一个测试路由
   @app.route('/test')
   def test():
       return "热重载测试成功！"
   ```

2. **保存文件**
   - 使用 Ctrl+S 或 Cmd+S 保存

3. **观察日志**
   ```bash
   tail -f app_output.log
   ```
   
   你会看到类似这样的输出：
   ```
   * Detected change in '/path/to/app.py', reloading
   * Restarting with stat
   * Debugger is active!
   ```

4. **访问新接口**
   ```bash
   curl http://localhost:5001/test
   ```

## 📊 重载时间

- **检测延迟**: 通常 1-2 秒
- **重启时间**: 2-5 秒
- **总耗时**: 约 3-7 秒

比手动重启快很多！

## 🎨 开发体验

### 之前的流程（❌ 麻烦）
```bash
1. 修改代码
2. 保存文件
3. 停止服务: lsof -ti:5001 | xargs kill -9
4. 启动服务: python app.py
5. 等待启动
6. 测试
```

### 现在的流程（✅ 简单）
```bash
1. 修改代码
2. 保存文件
3. 等待 3-7 秒（自动重载）
4. 刷新浏览器测试
```

## ⚙️ 配置说明

当前配置（app.py 最后几行）：
```python
if __name__ == '__main__':
    init_database()
    app.run(
        debug=True,           # 启用调试模式
        host='0.0.0.0',       # 监听所有接口
        port=5001,            # 端口号
        use_reloader=True,    # 启用自动重载 ⭐
        use_debugger=True     # 启用调试器
    )
```

## 🚨 注意事项

### 1. 环境变量修改
如果修改了 `.env` 文件，**仍然需要手动重启**：
```bash
lsof -ti:5001 | xargs kill -9
nohup python app.py > app_output.log 2>&1 &
```

### 2. 数据库修改
修改数据库结构后，可能需要：
```bash
# 删除旧数据库
rm resumes.db
# 重启服务（会自动重建）
lsof -ti:5001 | xargs kill -9
python app.py
```

### 3. 依赖包更新
安装新的包后需要重启：
```bash
pip install 新包名
# 然后重启服务
```

### 4. 全局变量
注意 `global_resume_pool` 和 `global_benefit_pool` 在重载后会被清空！

## 💡 最佳实践

1. **开发时**: 使用热重载，修改 Python 代码立即生效
2. **修改前端**: HTML/CSS/JS 修改后只需刷新浏览器
3. **修改配置**: .env 或依赖包需要手动重启
4. **生产环境**: 使用 gunicorn 等生产服务器，不启用 debug 模式

## 🔧 故障排除

### 问题：修改代码后没有重载

**可能原因**：
1. 文件保存失败 - 确认文件已保存
2. 语法错误 - 检查日志中的错误信息
3. 文件权限 - 确保文件可写

**解决方法**：
```bash
# 查看日志
tail -f app_output.log

# 如果没有自动重载，手动重启
lsof -ti:5001 | xargs kill -9
python app.py
```

### 问题：重载太慢

**原因**: 项目文件很多时，扫描需要时间

**解决方法**: 
- 正常情况，等待即可
- 如果超过 10 秒，可能出错了，查看日志

## 📈 性能影响

- **开发模式**: 有轻微性能损耗（5-10%），可接受
- **生产模式**: 不要使用 debug=True，无性能影响

## ✅ 总结

现在您可以：
- ✨ 修改代码 → 自动保存 → 等待几秒 → 直接测试
- 🚀 大幅提升开发效率
- 💪 专注于编码，而不是重启服务

享受热重载带来的流畅开发体验吧！🎉

